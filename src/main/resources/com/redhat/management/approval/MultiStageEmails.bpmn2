<?xml version="1.0" encoding="UTF-8"?>
<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.omg.org/bpmn20" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:bpsim="http://www.bpsim.org/schemas/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:drools="http://www.jboss.org/drools" id="_C1FZ0Ed0Eem_UelyPdEAxg" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd http://www.jboss.org/drools drools.xsd http://www.bpsim.org/schemas/1.0 bpsim.xsd" exporter="jBPM Designer" exporterVersion="1.0" expressionLanguage="http://www.mvel.org/2.0" targetNamespace="http://www.omg.org/bpmn20" typeLanguage="http://www.java.com/javaTypes">
  <bpmn2:itemDefinition id="_BackOfficeUrlItem" structureRef="String"/>
  <bpmn2:itemDefinition id="_BackOfficeHeadersItem" structureRef="String"/>
  <bpmn2:itemDefinition id="_BackOfficeBodyItem" structureRef="String"/>
  <bpmn2:itemDefinition id="_BackOfficeStatusItem" structureRef="Integer"/>
  <bpmn2:itemDefinition id="_BackOfficeResultItem" structureRef="Object"/>
  <bpmn2:itemDefinition id="_BackOfficeMsgItem" structureRef="String"/>
  <bpmn2:itemDefinition id="_RequestContentItem" structureRef="String"/>
  <bpmn2:itemDefinition id="_approval_requestItem" structureRef="com.redhat.management.approval.Request"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_TaskNameInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_MethodInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentDataInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UrlInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_HeadersInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ConnectTimeoutInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UsernameInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_PasswordInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ReadTimeoutInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentTypeInputXItem" structureRef="String"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ResultOutputXItem" structureRef="java.lang.Object"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusOutputXItem" structureRef="Integer"/>
  <bpmn2:itemDefinition id="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusMsgOutputXItem" structureRef="String"/>
  <bpmn2:process id="com.redhat.management.approval.MultiStageEmails" drools:packageName="com.redhat.management.approval" drools:version="1.0" name="MultiStageEmails" isExecutable="true">
    <bpmn2:property id="BackOfficeUrl" itemSubjectRef="_BackOfficeUrlItem"/>
    <bpmn2:property id="BackOfficeHeaders" itemSubjectRef="_BackOfficeHeadersItem"/>
    <bpmn2:property id="BackOfficeBody" itemSubjectRef="_BackOfficeBodyItem"/>
    <bpmn2:property id="BackOfficeStatus" itemSubjectRef="_BackOfficeStatusItem"/>
    <bpmn2:property id="BackOfficeResult" itemSubjectRef="_BackOfficeResultItem"/>
    <bpmn2:property id="BackOfficeMsg" itemSubjectRef="_BackOfficeMsgItem"/>
    <bpmn2:property id="RequestContent" itemSubjectRef="_RequestContentItem"/>
    <bpmn2:property id="approval_request" itemSubjectRef="_approval_requestItem"/>
    <bpmn2:startEvent id="_54F20DE8-9D7C-43D3-BB98-B83159993456" drools:selectable="true" color:background-color="#9acd32" color:border-color="#000000" color:color="#000000" name="">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:outgoing>_BB980627-76A5-4C4C-86F5-E97DE57232C1</bpmn2:outgoing>
    </bpmn2:startEvent>
    <bpmn2:scriptTask id="_E22866C0-5628-4BF6-97FC-7FBF9F0965FA" drools:selectable="true" color:background-color="#fafad2" color:border-color="#000000" color:color="#000000" name="Prepare" scriptFormat="http://www.java.com/java">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Prepare]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>_BB980627-76A5-4C4C-86F5-E97DE57232C1</bpmn2:incoming>
      <bpmn2:outgoing>_A12AFEE3-69BA-44FC-A28A-5EEB978F92B1</bpmn2:outgoing>
      <bpmn2:script><![CDATA[System.out.println("Prepare starts ....");

// Suppose everything should retrieve from kcontext variable [request]
//com.redhat.management.approval.Request req = (com.redhat.management.approval.Request) kcontext.getVariable("request");
//System.out.println("Request: " + req);

// So far create a faked request here

com.redhat.management.approval.Request req = new com.redhat.management.approval.Request();
java.util.ArrayList<com.redhat.management.approval.Approver> approvers = new java.util.ArrayList<com.redhat.management.approval.Approver>();


com.redhat.management.approval.Approver requester = new com.redhat.management.approval.Approver(1, "bill", "wei", "bzwei", "bzwei@redhat.com");
com.redhat.management.approval.Approver approver1 = new com.redhat.management.approval.Approver(1, "hui", "song", "hsong", "hsong@redhat.com");
com.redhat.management.approval.Approver approver2 = new com.redhat.management.approval.Approver(1, "hui2", "song2", "hsong2", "hsong@redhat.com");
com.redhat.management.approval.Approver approver3 = new com.redhat.management.approval.Approver(1, "hui3", "song3", "hsong3", "hsong@redhat.com");

approvers.add(approver1);
approvers.add(approver2);
approvers.add(approver3);
req.setApprovers(approvers);
req.setContent("THIS IS A TEST!");
req.setId(1);
req.setRequester(requester);


kcontext.setVariable("approvers", req.getApprovers());
kcontext.setVariable("content", req.getContent());]]></bpmn2:script>
    </bpmn2:scriptTask>
    <bpmn2:sequenceFlow id="_BB980627-76A5-4C4C-86F5-E97DE57232C1" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_54F20DE8-9D7C-43D3-BB98-B83159993456" targetRef="_E22866C0-5628-4BF6-97FC-7FBF9F0965FA"/>
    <bpmn2:endEvent id="_5685929A-FDC7-4204-A90D-B4174683BD8F" drools:selectable="true" color:background-color="#ff6347" color:border-color="#000000" color:color="#000000" name="">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>_E4610205-159A-42AF-B6B0-0F692E426A40</bpmn2:incoming>
    </bpmn2:endEvent>
    <bpmn2:task id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039" drools:selectable="true" drools:taskName="Rest" color:background-color="#fafad2" color:border-color="#000000" color:color="#000000" name="SendEmail">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[SendEmail]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>_6D7DFB2A-1C28-43B8-9CBE-DC51CE2F8B3D</bpmn2:incoming>
      <bpmn2:outgoing>_651F9722-C0A1-4134-87A3-910A08EECADE</bpmn2:outgoing>
      <bpmn2:ioSpecification id="_C1GA4Ed0Eem_UelyPdEAxg">
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_TaskNameInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_TaskNameInputXItem" name="TaskName"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_MethodInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_MethodInputXItem" name="Method"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentDataInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentDataInputXItem" name="ContentData"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UrlInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UrlInputXItem" name="Url"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_HeadersInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_HeadersInputXItem" name="Headers"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ConnectTimeoutInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ConnectTimeoutInputXItem" name="ConnectTimeout"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UsernameInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UsernameInputXItem" name="Username"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_PasswordInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_PasswordInputXItem" name="Password"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ReadTimeoutInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ReadTimeoutInputXItem" name="ReadTimeout"/>
        <bpmn2:dataInput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentTypeInputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentTypeInputXItem" name="ContentType"/>
        <bpmn2:dataOutput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ResultOutputX" drools:dtype="java.lang.Object" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ResultOutputXItem" name="Result"/>
        <bpmn2:dataOutput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusOutputX" drools:dtype="Integer" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusOutputXItem" name="Status"/>
        <bpmn2:dataOutput id="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusMsgOutputX" drools:dtype="String" itemSubjectRef="__D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusMsgOutputXItem" name="StatusMsg"/>
        <bpmn2:inputSet id="_C1GA4Ud0Eem_UelyPdEAxg">
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_MethodInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentDataInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UrlInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_HeadersInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ConnectTimeoutInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UsernameInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_PasswordInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ReadTimeoutInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentTypeInputX</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_TaskNameInputX</bpmn2:dataInputRefs>
        </bpmn2:inputSet>
        <bpmn2:outputSet id="_C1GA4kd0Eem_UelyPdEAxg">
          <bpmn2:dataOutputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ResultOutputX</bpmn2:dataOutputRefs>
          <bpmn2:dataOutputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusOutputX</bpmn2:dataOutputRefs>
          <bpmn2:dataOutputRefs>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusMsgOutputX</bpmn2:dataOutputRefs>
        </bpmn2:outputSet>
      </bpmn2:ioSpecification>
      <bpmn2:dataInputAssociation id="_C1GA40d0Eem_UelyPdEAxg">
        <bpmn2:targetRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_TaskNameInputX</bpmn2:targetRef>
        <bpmn2:assignment id="_C1GA5Ed0Eem_UelyPdEAxg">
          <bpmn2:from xsi:type="bpmn2:tFormalExpression" id="_C1GA5Ud0Eem_UelyPdEAxg"><![CDATA[Rest]]></bpmn2:from>
          <bpmn2:to xsi:type="bpmn2:tFormalExpression" id="_C1GA5kd0Eem_UelyPdEAxg">_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_TaskNameInputX</bpmn2:to>
        </bpmn2:assignment>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataInputAssociation id="_C1GA50d0Eem_UelyPdEAxg">
        <bpmn2:targetRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_MethodInputX</bpmn2:targetRef>
        <bpmn2:assignment id="_C1GA6Ed0Eem_UelyPdEAxg">
          <bpmn2:from xsi:type="bpmn2:tFormalExpression" id="_C1GA6Ud0Eem_UelyPdEAxg"><![CDATA[POST]]></bpmn2:from>
          <bpmn2:to xsi:type="bpmn2:tFormalExpression" id="_C1GA6kd0Eem_UelyPdEAxg">_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_MethodInputX</bpmn2:to>
        </bpmn2:assignment>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataInputAssociation id="_C1GA60d0Eem_UelyPdEAxg">
        <bpmn2:sourceRef>BackOfficeBody</bpmn2:sourceRef>
        <bpmn2:targetRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentDataInputX</bpmn2:targetRef>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataInputAssociation id="_C1GA7Ed0Eem_UelyPdEAxg">
        <bpmn2:sourceRef>BackOfficeUrl</bpmn2:sourceRef>
        <bpmn2:targetRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_UrlInputX</bpmn2:targetRef>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataInputAssociation id="_C1GA7Ud0Eem_UelyPdEAxg">
        <bpmn2:sourceRef>BackOfficeHeaders</bpmn2:sourceRef>
        <bpmn2:targetRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_HeadersInputX</bpmn2:targetRef>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataInputAssociation id="_C1GA7kd0Eem_UelyPdEAxg">
        <bpmn2:targetRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentTypeInputX</bpmn2:targetRef>
        <bpmn2:assignment id="_C1GA70d0Eem_UelyPdEAxg">
          <bpmn2:from xsi:type="bpmn2:tFormalExpression" id="_C1GA8Ed0Eem_UelyPdEAxg"><![CDATA[application/json]]></bpmn2:from>
          <bpmn2:to xsi:type="bpmn2:tFormalExpression" id="_C1GA8Ud0Eem_UelyPdEAxg">_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ContentTypeInputX</bpmn2:to>
        </bpmn2:assignment>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataOutputAssociation id="_C1GA8kd0Eem_UelyPdEAxg">
        <bpmn2:sourceRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_ResultOutputX</bpmn2:sourceRef>
        <bpmn2:targetRef>BackOfficeResult</bpmn2:targetRef>
      </bpmn2:dataOutputAssociation>
      <bpmn2:dataOutputAssociation id="_C1GA80d0Eem_UelyPdEAxg">
        <bpmn2:sourceRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusOutputX</bpmn2:sourceRef>
        <bpmn2:targetRef>BackOfficeStatus</bpmn2:targetRef>
      </bpmn2:dataOutputAssociation>
      <bpmn2:dataOutputAssociation id="_C1GA9Ed0Eem_UelyPdEAxg">
        <bpmn2:sourceRef>_D5CA81AE-5CE5-4AA1-980B-45FB29B49039_StatusMsgOutputX</bpmn2:sourceRef>
        <bpmn2:targetRef>BackOfficeMsg</bpmn2:targetRef>
      </bpmn2:dataOutputAssociation>
    </bpmn2:task>
    <bpmn2:exclusiveGateway id="_D4A2EF08-9BB9-46BB-AB8F-660C16619301" drools:selectable="true" drools:dg="" color:background-color="#f0e68c" color:border-color="#a67f00" color:color="#000000" name="" gatewayDirection="Converging">
      <bpmn2:incoming>_A12AFEE3-69BA-44FC-A28A-5EEB978F92B1</bpmn2:incoming>
      <bpmn2:incoming>_90394ABC-AA78-4DD8-ABC8-181755E4FFD6</bpmn2:incoming>
      <bpmn2:outgoing>_A41C1405-159D-49C2-A89E-B3911E916B64</bpmn2:outgoing>
    </bpmn2:exclusiveGateway>
    <bpmn2:sequenceFlow id="_A12AFEE3-69BA-44FC-A28A-5EEB978F92B1" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_E22866C0-5628-4BF6-97FC-7FBF9F0965FA" targetRef="_D4A2EF08-9BB9-46BB-AB8F-660C16619301"/>
    <bpmn2:exclusiveGateway id="_0744354A-7FDF-4A78-BCB5-BD6FA9B44926" drools:selectable="true" drools:dg="" color:background-color="#f0e68c" color:border-color="#a67f00" color:color="#000000" name="" gatewayDirection="Diverging">
      <bpmn2:incoming>_651F9722-C0A1-4134-87A3-910A08EECADE</bpmn2:incoming>
      <bpmn2:outgoing>_E4610205-159A-42AF-B6B0-0F692E426A40</bpmn2:outgoing>
      <bpmn2:outgoing>_90394ABC-AA78-4DD8-ABC8-181755E4FFD6</bpmn2:outgoing>
    </bpmn2:exclusiveGateway>
    <bpmn2:sequenceFlow id="_651F9722-C0A1-4134-87A3-910A08EECADE" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039" targetRef="_0744354A-7FDF-4A78-BCB5-BD6FA9B44926"/>
    <bpmn2:sequenceFlow id="_E4610205-159A-42AF-B6B0-0F692E426A40" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_0744354A-7FDF-4A78-BCB5-BD6FA9B44926" targetRef="_5685929A-FDC7-4204-A90D-B4174683BD8F">
      <bpmn2:conditionExpression xsi:type="bpmn2:tFormalExpression" id="_C1GA9Ud0Eem_UelyPdEAxg" language="http://www.java.com/java"><![CDATA[java.util.ArrayList<com.redhat.management.approval.Approver> approvers = (java.util.ArrayList<com.redhat.management.approval.Approver>) kcontext.getVariable("approvers");

System.out.println("# of approvers:" + approvers.size());

return approvers.size() == 0;]]></bpmn2:conditionExpression>
    </bpmn2:sequenceFlow>
    <bpmn2:sequenceFlow id="_90394ABC-AA78-4DD8-ABC8-181755E4FFD6" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_0744354A-7FDF-4A78-BCB5-BD6FA9B44926" targetRef="_D4A2EF08-9BB9-46BB-AB8F-660C16619301">
      <bpmn2:conditionExpression xsi:type="bpmn2:tFormalExpression" id="_C1GA9kd0Eem_UelyPdEAxg" language="http://www.java.com/java"><![CDATA[java.util.ArrayList<com.redhat.management.approval.Approver> approvers = (java.util.ArrayList<com.redhat.management.approval.Approver>) kcontext.getVariable("approvers");

System.out.println("# of approvers:" + approvers.size());

return approvers.size() > 0;]]></bpmn2:conditionExpression>
    </bpmn2:sequenceFlow>
    <bpmn2:scriptTask id="_56752DEC-FFF8-4623-AB0D-DD1D8F43D8C9" drools:selectable="true" color:background-color="#fafad2" color:border-color="#000000" color:color="#000000" name="preSendEmail" scriptFormat="http://www.java.com/java">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[preSendEmail]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>_A41C1405-159D-49C2-A89E-B3911E916B64</bpmn2:incoming>
      <bpmn2:outgoing>_6D7DFB2A-1C28-43B8-9CBE-DC51CE2F8B3D</bpmn2:outgoing>
      <bpmn2:script><![CDATA[System.out.println("Pre send email starts ...");


java.util.ArrayList<com.redhat.management.approval.Approver> approvers = (java.util.ArrayList<com.redhat.management.approval.Approver>) kcontext.getVariable("approvers");

String req_content = (String) kcontext.getVariable("content");
System.out.println("Reqeust content: " + req_content);
System.out.println("# of approvers: " + approvers.size());

com.redhat.management.approval.Approver current = approvers.remove(0);

System.out.println("# of approvers now: " + approvers.size());


com.redhat.management.approval.EmailHandler emailHandler = new com.redhat.management.approval.EmailHandler();

System.out.println("header: " + emailHandler.getHeaders());
kcontext.setVariable("BackOfficeHeaders", emailHandler.getHeaders());

System.out.println("body: " + emailHandler.getBody(current, req_content));
kcontext.setVariable("BackOfficeBody", emailHandler.getBody(current, req_content));

System.out.println("url: " + emailHandler.getUrl());
kcontext.setVariable("BackOfficeUrl", emailHandler.getUrl());

kcontext.setVariable("approvers", approvers);


  ]]></bpmn2:script>
    </bpmn2:scriptTask>
    <bpmn2:sequenceFlow id="_A41C1405-159D-49C2-A89E-B3911E916B64" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_D4A2EF08-9BB9-46BB-AB8F-660C16619301" targetRef="_56752DEC-FFF8-4623-AB0D-DD1D8F43D8C9"/>
    <bpmn2:sequenceFlow id="_6D7DFB2A-1C28-43B8-9CBE-DC51CE2F8B3D" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_56752DEC-FFF8-4623-AB0D-DD1D8F43D8C9" targetRef="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039"/>
  </bpmn2:process>
  <bpmndi:BPMNDiagram id="_C1GA90d0Eem_UelyPdEAxg">
    <bpmndi:BPMNPlane id="_C1GA-Ed0Eem_UelyPdEAxg" bpmnElement="com.redhat.management.approval.MultiStageEmails">
      <bpmndi:BPMNShape id="_C1GA-Ud0Eem_UelyPdEAxg" bpmnElement="_54F20DE8-9D7C-43D3-BB98-B83159993456">
        <dc:Bounds height="30.0" width="30.0" x="60.0" y="165.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_C1GA-kd0Eem_UelyPdEAxg" bpmnElement="_E22866C0-5628-4BF6-97FC-7FBF9F0965FA">
        <dc:Bounds height="80.0" width="100.0" x="195.0" y="140.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_C1GA-0d0Eem_UelyPdEAxg" bpmnElement="_5685929A-FDC7-4204-A90D-B4174683BD8F">
        <dc:Bounds height="28.0" width="28.0" x="945.0" y="166.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_C1GA_Ed0Eem_UelyPdEAxg" bpmnElement="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039">
        <dc:Bounds height="80.0" width="100.0" x="645.0" y="140.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_C1GA_Ud0Eem_UelyPdEAxg" bpmnElement="_D4A2EF08-9BB9-46BB-AB8F-660C16619301">
        <dc:Bounds height="40.0" width="40.0" x="360.0" y="160.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_C1GA_kd0Eem_UelyPdEAxg" bpmnElement="_0744354A-7FDF-4A78-BCB5-BD6FA9B44926">
        <dc:Bounds height="40.0" width="40.0" x="810.0" y="160.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_C1GA_0d0Eem_UelyPdEAxg" bpmnElement="_56752DEC-FFF8-4623-AB0D-DD1D8F43D8C9">
        <dc:Bounds height="80.0" width="100.0" x="465.0" y="140.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="_C1GBAEd0Eem_UelyPdEAxg" bpmnElement="_BB980627-76A5-4C4C-86F5-E97DE57232C1" sourceElement="_C1GA-Ud0Eem_UelyPdEAxg" targetElement="_C1GA-kd0Eem_UelyPdEAxg">
        <di:waypoint xsi:type="dc:Point" x="75.0" y="180.0"/>
        <di:waypoint xsi:type="dc:Point" x="245.0" y="180.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="_C1GBAUd0Eem_UelyPdEAxg" bpmnElement="_A12AFEE3-69BA-44FC-A28A-5EEB978F92B1" sourceElement="_C1GA-kd0Eem_UelyPdEAxg" targetElement="_C1GA_Ud0Eem_UelyPdEAxg">
        <di:waypoint xsi:type="dc:Point" x="245.0" y="180.0"/>
        <di:waypoint xsi:type="dc:Point" x="380.0" y="180.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="_C1GBAkd0Eem_UelyPdEAxg" bpmnElement="_651F9722-C0A1-4134-87A3-910A08EECADE" sourceElement="_C1GA_Ed0Eem_UelyPdEAxg" targetElement="_C1GA_kd0Eem_UelyPdEAxg">
        <di:waypoint xsi:type="dc:Point" x="695.0" y="180.0"/>
        <di:waypoint xsi:type="dc:Point" x="830.0" y="180.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="_C1GBA0d0Eem_UelyPdEAxg" bpmnElement="_E4610205-159A-42AF-B6B0-0F692E426A40" sourceElement="_C1GA_kd0Eem_UelyPdEAxg" targetElement="_C1GA-0d0Eem_UelyPdEAxg">
        <di:waypoint xsi:type="dc:Point" x="830.0" y="180.0"/>
        <di:waypoint xsi:type="dc:Point" x="959.0" y="180.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="_C1GBBEd0Eem_UelyPdEAxg" bpmnElement="_90394ABC-AA78-4DD8-ABC8-181755E4FFD6" sourceElement="_C1GA_kd0Eem_UelyPdEAxg" targetElement="_C1GA_Ud0Eem_UelyPdEAxg">
        <di:waypoint xsi:type="dc:Point" x="830.0" y="180.0"/>
        <di:waypoint xsi:type="dc:Point" x="830.0" y="334.0"/>
        <di:waypoint xsi:type="dc:Point" x="380.0" y="334.0"/>
        <di:waypoint xsi:type="dc:Point" x="380.0" y="180.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="_C1GBBUd0Eem_UelyPdEAxg" bpmnElement="_A41C1405-159D-49C2-A89E-B3911E916B64" sourceElement="_C1GA_Ud0Eem_UelyPdEAxg" targetElement="_C1GA_0d0Eem_UelyPdEAxg">
        <di:waypoint xsi:type="dc:Point" x="380.0" y="180.0"/>
        <di:waypoint xsi:type="dc:Point" x="515.0" y="180.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="_C1GBBkd0Eem_UelyPdEAxg" bpmnElement="_6D7DFB2A-1C28-43B8-9CBE-DC51CE2F8B3D" sourceElement="_C1GA_0d0Eem_UelyPdEAxg" targetElement="_C1GA_Ed0Eem_UelyPdEAxg">
        <di:waypoint xsi:type="dc:Point" x="515.0" y="180.0"/>
        <di:waypoint xsi:type="dc:Point" x="695.0" y="180.0"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
  <bpmn2:relationship id="_C1GBB0d0Eem_UelyPdEAxg" type="BPSimData">
    <bpmn2:extensionElements>
      <bpsim:BPSimData>
        <bpsim:Scenario xsi:type="bpsim:Scenario" id="default" name="Simulationscenario">
          <bpsim:ScenarioParameters xsi:type="bpsim:ScenarioParameters" baseTimeUnit="min"/>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_E22866C0-5628-4BF6-97FC-7FBF9F0965FA" id="_C1GBCEd0Eem_UelyPdEAxg">
            <bpsim:TimeParameters xsi:type="bpsim:TimeParameters">
              <bpsim:ProcessingTime xsi:type="bpsim:Parameter">
                <bpsim:UniformDistribution max="10.0" min="5.0"/>
              </bpsim:ProcessingTime>
            </bpsim:TimeParameters>
            <bpsim:CostParameters xsi:type="bpsim:CostParameters">
              <bpsim:UnitCost xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="0.0"/>
              </bpsim:UnitCost>
            </bpsim:CostParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_56752DEC-FFF8-4623-AB0D-DD1D8F43D8C9" id="_C1GBCUd0Eem_UelyPdEAxg">
            <bpsim:TimeParameters xsi:type="bpsim:TimeParameters">
              <bpsim:ProcessingTime xsi:type="bpsim:Parameter">
                <bpsim:UniformDistribution max="10.0" min="5.0"/>
              </bpsim:ProcessingTime>
            </bpsim:TimeParameters>
            <bpsim:CostParameters xsi:type="bpsim:CostParameters">
              <bpsim:UnitCost xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="0.0"/>
              </bpsim:UnitCost>
            </bpsim:CostParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_54F20DE8-9D7C-43D3-BB98-B83159993456" id="_C1GBCkd0Eem_UelyPdEAxg">
            <bpsim:TimeParameters xsi:type="bpsim:TimeParameters">
              <bpsim:ProcessingTime xsi:type="bpsim:Parameter">
                <bpsim:UniformDistribution max="10.0" min="5.0"/>
              </bpsim:ProcessingTime>
            </bpsim:TimeParameters>
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_651F9722-C0A1-4134-87A3-910A08EECADE" id="_C1GBC0d0Eem_UelyPdEAxg">
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_E4610205-159A-42AF-B6B0-0F692E426A40" id="_C1GBDEd0Eem_UelyPdEAxg">
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_A12AFEE3-69BA-44FC-A28A-5EEB978F92B1" id="_C1GBDUd0Eem_UelyPdEAxg">
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_A41C1405-159D-49C2-A89E-B3911E916B64" id="_C1GBDkd0Eem_UelyPdEAxg">
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_D5CA81AE-5CE5-4AA1-980B-45FB29B49039" id="_C1GBD0d0Eem_UelyPdEAxg">
            <bpsim:TimeParameters xsi:type="bpsim:TimeParameters">
              <bpsim:ProcessingTime xsi:type="bpsim:Parameter">
                <bpsim:UniformDistribution max="10.0" min="5.0"/>
              </bpsim:ProcessingTime>
            </bpsim:TimeParameters>
            <bpsim:CostParameters xsi:type="bpsim:CostParameters">
              <bpsim:UnitCost xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="0.0"/>
              </bpsim:UnitCost>
            </bpsim:CostParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_6D7DFB2A-1C28-43B8-9CBE-DC51CE2F8B3D" id="_C1GBEEd0Eem_UelyPdEAxg">
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_5685929A-FDC7-4204-A90D-B4174683BD8F" id="_C1GBEUd0Eem_UelyPdEAxg">
            <bpsim:TimeParameters xsi:type="bpsim:TimeParameters">
              <bpsim:ProcessingTime xsi:type="bpsim:Parameter">
                <bpsim:UniformDistribution max="10.0" min="5.0"/>
              </bpsim:ProcessingTime>
            </bpsim:TimeParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_90394ABC-AA78-4DD8-ABC8-181755E4FFD6" id="_C1GBEkd0Eem_UelyPdEAxg">
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
          <bpsim:ElementParameters xsi:type="bpsim:ElementParameters" elementRef="_BB980627-76A5-4C4C-86F5-E97DE57232C1" id="_C1GBE0d0Eem_UelyPdEAxg">
            <bpsim:ControlParameters xsi:type="bpsim:ControlParameters">
              <bpsim:Probability xsi:type="bpsim:Parameter">
                <bpsim:FloatingParameter value="100.0"/>
              </bpsim:Probability>
            </bpsim:ControlParameters>
          </bpsim:ElementParameters>
        </bpsim:Scenario>
      </bpsim:BPSimData>
    </bpmn2:extensionElements>
    <bpmn2:source>_C1FZ0Ed0Eem_UelyPdEAxg</bpmn2:source>
    <bpmn2:target>_C1FZ0Ed0Eem_UelyPdEAxg</bpmn2:target>
  </bpmn2:relationship>
</bpmn2:definitions>
